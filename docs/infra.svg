AWS [icon: aws-cloud] {
  Client [icon: user]

  MainQueue [icon: aws-simple-queue-service, label: "MainQueue (SQS Standard Queue)"]

  MessageProcessorFunction [icon: aws-lambda, label: "Message Processor Function (Java 17, 512MB, 60s)"]

  DeadLetterQueue [icon: aws-sqs, label: "Dead Letter Queue(DLQ, 3-day retention)"]

  DLQMessageAlarm [icon: aws-cloudwatch, label: "DLQMessageAlarm (CloudWatch Alarm)"]

  DLQAlarmSNSTopic [icon: aws-sns, label: "DLQAlarm SNSTopic (SNS Topic)"]

  MessageRedriveFunction [icon: aws-lambda, label: "Message Redrive Function (Java 17, 512MB, 60s)"]
}

// Connections
Client > MainQueue: Send Message

MainQueue > MessageProcessorFunction: Poll & Process Message [color: Black]



MainQueue > DeadLetterQueue: Move to DLQ after 3 failed attempts (Redrive Policy)

DeadLetterQueue > DLQMessageAlarm: Monitor ApproximateAgeOfOldestMessage  > Threshold(300 sec)

DLQMessageAlarm > DLQAlarmSNSTopic: Publish Alarm Notification

DLQAlarmSNSTopic > MessageRedriveFunction: Invoke Lambda


MainQueue < MessageProcessorFunction: Delete Message on Success
MainQueue < MessageProcessorFunction: Retry on Failure, up to 3 times
DeadLetterQueue < MessageRedriveFunction: Poll & Read Failed Messages
MainQueue < MessageRedriveFunction: Redrive Messages
